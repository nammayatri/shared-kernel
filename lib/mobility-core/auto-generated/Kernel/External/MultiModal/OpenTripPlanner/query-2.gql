query MultiModePlan(
  $from: InputCoordinates!,
  $to: InputCoordinates!,
  $date: String,
  $time: String,
  $metroTransportModes: [TransportMode]!,
  $metroItineraries: Int!
  $subwayTransportModes: [TransportMode]!,
  $subwayItineraries: Int!
  $busTransportModes: [TransportMode]!,
  $busItineraries: Int!
  $bestTransportModes: [TransportMode]!,
  $bestItineraries: Int!,
  # Actually Long
  $searchWindow: Int,
  $noOptimization: Boolean,
  # Actually Long
  $busSearchWindow: Int,
) {
  metro: plan(
    from: $from,
    to:   $to,
    date: $date,
    time: $time,
    transportModes: $metroTransportModes,
    numItineraries: $metroItineraries,
    searchWindow: $searchWindow,
    noOptimization: $noOptimization,
  ) {
    itineraries { ...ItineraryFields }
  }
  subway: plan(
    from: $from,
    to:   $to,
    date: $date,
    time: $time,
    transportModes: $subwayTransportModes,
    numItineraries: $subwayItineraries,
    searchWindow: $searchWindow,
    noOptimization: $noOptimization,
  ) {
    itineraries { ...ItineraryFields }
  }
  bus: plan(
    from: $from,
    to:   $to,
    date: $date,
    time: $time,
    transportModes: $busTransportModes,
    numItineraries: $busItineraries,
    searchWindow: $busSearchWindow,
    noOptimization: $noOptimization,
  ) {
    itineraries { ...ItineraryFields }
  }
  best: plan(
    from: $from,
    to:   $to,
    date: $date,
    time: $time,
    transportModes: $bestTransportModes,
    numItineraries: $bestItineraries,
    searchWindow: $searchWindow,
    noOptimization: $noOptimization,
  ) {
    itineraries { ...ItineraryFields }
  }
}

fragment ItineraryFields on Itinerary {
  duration
  startTime
  endTime
  legs {
    pickupType
    distance
    mode
    entrance {
      distance
      lon
      lat
      relativeDirection
      absoluteDirection
      streetName
      exit
      stayOn
      area
      bogusName
      walkingBike
    }
    exit {
      distance
      lon
      lat
      relativeDirection
      absoluteDirection
      streetName
      exit
      stayOn
      area
      bogusName
      walkingBike
    }
    duration
    startTime
    endTime
    from {
      name
      lat
      lon
      departureTime
      arrivalTime
      stop {
        code
        gtfsId
        platformCode
      }
    }
    to {
      name
      lat
      lon
      departureTime
      arrivalTime
      stop {
        code
        gtfsId
        platformCode
      }
    }
    route {
      gtfsId
      longName
      trips {
        gtfsId
      }
      shortName
      color
      agency {
        gtfsId
        name
      }
    }
    legGeometry {
      points
    }
    fareProducts {
      id
    }
  }
}
